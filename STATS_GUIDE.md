# 題目統計系統使用指南

## 📋 功能概述

本系統允許 Admin 和教師通過簡單的按鈕點擊來：
- 📊 實時更新每題的正確率統計
- 🎯 自動或手動調整題目難度
- 📈 查看題目的詳細統計數據

---

## 🎮 Admin 操作方式

### 方式一：在 Admin 後台執行

1. **登入 Django Admin**
   - 訪問 `http://localhost:8000/admin/`
   - 使用管理員帳號登入

2. **進入題目管理頁面**
   - 左側菜單 → **題目** → 點進去

3. **執行統計（選擇其中一個）**
   
   **選項A - 只更新統計（不調整難度）**
   - 選中一個或多個題目（或全選）
   - 頁面上方下拉選單選擇：**「📊 執行題目統計與難度調整」**
   - 點擊 **「執行」**
   
   **選項B - 更新統計 + 自動調整難度**
   - 選中一個或多個題目（或全選）
   - 頁面上方下拉選單選擇：**「📊 執行統計 + 自動調整難度」**
   - 點擊 **「執行」**

4. **查看結果**
   - 頁面右上會顯示「✓ 題目統計已更新完成！」或「✓ 題目統計已更新，難度已自動調整！」
   - 重新整理頁面，查看「正確率」欄位的新數據

### 查看統計詳情

1. 點擊任一題目進入編輯頁面
2. 向下滑動到 **「統計資訊」** 區域（預設摺疊）
3. 展開查看：
   - **正確作答人數**
   - **總作答次數**
   - **正確率（%）**
   - **最後統計更新時間**

---

## 📊 統計欄位說明

| 欄位 | 說明 |
|------|------|
| **正確率** | 顯示在列表中，用彩色表示 |
| **正確率顏色代碼** | 🟢 ≥80% (綠色) \| 🟠 30-80% (橙色) \| 🔴 <30% (紅色) |
| **格式** | `✓ 正確率% (正確數/總次數)` |

**範例：**
- `✓ 95.0% (19/20)` → 綠色，20 人中 19 人答對
- `≈ 55.0% (11/20)` → 橙色，中等難度
- `✗ 15.0% (3/20)` → 紅色，大多數人答錯

---

## 🔄 難度自動調整規則

當執行「**執行統計 + 自動調整難度**」時，系統會根據以下規則自動調整：

> **前提條件**：該題至少要有 5 次以上的作答記錄

| 正確率 | 難度調整 | 說明 |
|--------|--------|------|
| **< 30%** | ⬆️ +1 | 太難了，難度提升（更多學生答不對） |
| **> 80%** | ⬇️ -1 | 太簡單了，難度降低（太多學生答對） |
| **30% ~ 80%** | ➡️ 不變 | 難度適中，保持不變 |

**難度範圍**：1（簡單）、2（中等）、3（困難）

---

## 💻 命令行操作（技術人員）

如果需要在命令行執行統計更新：

### 只更新統計數據
```bash
python manage.py update_question_stats
```

### 更新統計 + 自動調整難度
```bash
python manage.py update_question_stats --auto-adjust
```

---

## 🗄️ 資料庫欄位

新增至 `Question` 模型的欄位：

```python
correct_count      # 正確作答人數
total_attempts     # 總作答次數
correct_rate       # 正確率 (%) 
last_stat_updated  # 最後統計更新時間
```

---

## 📝 使用建議

✅ **最佳實踐**
- 定期執行統計（例如每周一次）
- 查看統計結果後再決定是否自動調整
- 對於新題目（作答少於 5 次），手動檢查而不依賴自動調整
- 在調整難度前，查看詳細的正確率趨勢

⚠️ **注意事項**
- 自動調整難度需要至少 5 次作答才會觸發
- 難度只能在 1-3 之間調整（不會超出範圍）
- 更新統計是追溯性的，只計算已記錄的作答結果

---

## 🐛 故障排除

**Q: 按下按鈕後沒有反應？**
- A: 檢查是否選中了題目，或嘗試重新整理頁面

**Q: 正確率沒有更新？**
- A: 確認是否有新的作答記錄，或檢查 `StudentAnswer` 表中是否有 `is_correct` 值

**Q: 難度沒有自動調整？**
- A: 檢查該題是否至少有 5 次作答（在統計資訊中查看總次數）
